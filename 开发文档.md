# 《赏金猎人》游戏开发文档

## 项目概述
《赏金猎人》是一款基于Web的冒险解谜游戏，玩家将扮演主角，在一个充满科幻色彩的世界中探索、解谜并完成各种任务。本文档面向其他开发者，提供游戏核心JavaScript运行逻辑、功能实现及剧情修改指南。

## 目录结构
```
.\js\              # JavaScript脚本文件
├── archive.js      # 存档系统
├── clue.js         # 线索和成就系统
├── end.js          # 结局系统
├── hurdle.js       # 碰撞检测系统
├── init.js         # 游戏初始化
├── interact.js     # 角色交互和控制
├── jquery-1.8.3.min.js # jQuery库
├── map.js          # 地图系统
├── npc.js          # NPC对话系统
├── object.js       # 物品交互系统
├── patch.js        # 补丁和修复逻辑
└── startgame.js    # 游戏启动逻辑
```

## 核心系统详解

### 1. 游戏初始化系统 (init.js)

**主要功能**：定义游戏全局变量、初始化碰撞检测、交互系统、背包系统和场景管理。

**关键变量**：
- `herowidth`/`heroheight`：角色尺寸
- `mapwidth`/`mapheight`：地图尺寸
- `wallx`/`wally`：碰撞检测坐标数组
- `object`/`npc`：物品和NPC数组
- `obj`/`person`/`trans`：当前交互对象
- `backpack`：背包数组
- `last_phase`/`now_phase`：场景管理
- `option_now`：角色移动控制

**修改点**：可在此文件中调整初始变量，如角色位置、初始物品等，没搞清楚具体剧情逻辑就别动。

### 2. 角色交互和控制系统 (interact.js)

**主要功能**：处理角色移动、交互、地图显示和暂停菜单等核心游戏操作。

**关键函数**：
- `stop()`：判断是否阻止角色移动
- 键盘事件处理：WASD移动、E键交互、F键地图、ESC键暂停
- 角色移动定时器：控制角色位置更新和碰撞检测


### 3. 地图系统 (map.js)

**主要功能**：加载不同场景地图、设置墙壁碰撞数据、门的位置和场景转换。

**关键函数**：
- `loadmap(phase)`：根据场景ID加载对应的地图资源和碰撞数据
- `transform(phase)`：根据场景ID转换角色位置和地图

**修改点**：修改`wallx`/`wally`数组调整地图碰撞区域，修改`door`数组调整门的位置和目标场景，以及`npc`,`object`数组。

### 4. NPC对话系统 (npc.js)

**主要功能**：处理与NPC的对话逻辑和内容展示。

**关键函数**：
- `dialog(man)`：根据NPC类型和对话阶段显示不同的对话内容

**修改点**：修改对话文本、增加新NPC、调整对话分支和条件判断。

### 5. 物品交互系统 (object.js)

**主要功能**：处理物品的交互逻辑和信息展示。

**关键函数**：
- `interact(object)`：根据物品类型显示不同的交互内容

**修改点**：添加新物品、修改物品描述和交互效果。

### 6. 碰撞检测系统 (hurdle.js)

**主要功能**：提供碰撞检测和交互区域判断的核心函数。

**关键函数**：
- `inner(l,ql,qr)`：判断坐标是否在区间内
- `check(op,wall,x,y)`：计算移动限制值
- `hotzone(x,y,obj)`：判断是否在交互区域内

**剧情修改点**：不要修改，而是在创建可交互对象时，设置好交互区域的坐标和大小。

### 7. 线索和成就系统 (clue.js)

**主要功能**：管理游戏中的成就系统。

**关键函数**：
- `addachievement(id)`：添加成就并显示成就提示

**修改点**：添加新成就、修改成就名称和触发条件。


### 8. CG和强制交互检测 (patch.js)

**主要功能**：处理特殊场景的触发逻辑和CG播放。

**关键函数**：
- `cg(id)`：播放指定的CG动画
- 多个`setInterval`定时器：检测特定条件并触发事件

**修改点**：添加新的CG动画、调整触发条件和事件顺序。

## 剧情修改指南

### 1. 对话内容修改
- 在`npc.js`中找到对应NPC的对话函数
- 修改`switch`语句中的对话文本和分支逻辑
- 可以增加新的NPC对话变量来扩展剧情，要在`init.js`中定义好全局变量，在`map.js`中引用
- npc是个长度为4的数组，分别是x坐标，y坐标，可对话半径，名字（要打引号表示字符串，不然变成全局变量了）

### 2. 结局内容修改
- 在`end.js`中修改对应结局的图片路径和文本内容
- 调整`setTimeout`的时间来改变画面切换速度

### 3. 场景和地图修改
- 在`map.js`中添加新的场景加载逻辑
- 修改`wallx`/`wally`数组调整地图碰撞区域
- 更新`door`数组添加新的场景转换点，与npc类似，最后一个元素是目标场景的名字（字符串）
- 每个地图都要有npc，object，door数组，不管是不是空的

### 4. 物品和交互修改
- 在`object.js`中添加新物品的交互逻辑
- 修改`interact`函数中的文本描述
- object与npc类似

### 5. 成就系统修改
- 在`clue.js`的`addachievement`函数中添加新的成就ID和名称
- 在游戏逻辑中适当位置调用`addachievement`函数触发成就

## 注意事项

1. 修改代码前请先从github上拉取最新代码！！！
2. 新增功能时请遵循现有代码风格和逻辑结构
3. 大部分图片资源放置在`img`目录下，注意路径引用
4. 测试时请确保不同场景和交互都能正常工作

## 开发团队
- 项目经理：许辰闯
- CIO、编剧：龚雅君
- 技术总监：王纪石
- 美工：林伟豪
- 程序员：周子义
- 测试工程师：许丽娜

---
本文档仅供项目内部开发参考使用。