# 赏金猎人项目 - 页面导航与浏览器安全机制技术文档

## 1. 项目导航架构概述

赏金猎人项目采用了混合导航架构，主要包括：

- **index.html**：作为入口页面，包含音乐播放器和一个iframe
- **iframe加载**：index.html中的iframe加载login.html
- **标准页面跳转**：其他页面间的导航使用标准页面跳转

## 2. 浏览器安全机制与项目的限制

### 2.1 同源策略（Same-Origin Policy）

同源策略是浏览器的核心安全机制，限制了不同源之间的交互。源（Origin）由协议、域名和端口三部分组成。

在使用file://协议（直接打开本地HTML文件）时：
- 不同文件夹下的HTML文件被视为不同源
- iframe加载不同路径的本地文件可能被拦截

### 2.2 项目中的具体限制

用户的理解是正确的：

> 导致拦截机制的不是iframe里的元素变化，而是父页面本身使用iframe打开另一个页面这件事

具体来说：
- **index.html和login.html**：位于同一路径，可以通过iframe加载
- **home.html**：位于子文件夹中，与index.html不同源，无法通过iframe直接加载

## 3. 项目解决方案

### 3.1 导航架构设计

项目采用了以下导航架构来解决浏览器安全限制：

1. **保留必要的iframe**：
   - index.html中保留iframe加载login.html
   - 保留音乐播放器在index.html中

2. **使用标准页面跳转**：
   - 登录成功后，直接跳转到home.html（`window.location.href = './home/home.html'`）
   - 从home页面注销时，直接跳转到login.html（`window.location.href = '../login.html'`）
   - 其他页面间导航使用`window.open("../page.html","_self")`

### 3.2 音乐播放器处理

为了保持音乐持续播放：

1. 音乐播放器放置在index.html中（不在iframe内）
2. 页面跳转时避免重新加载index.html
3. 从home页面注销时跳转到login.html而非index.html，避免音乐播放器重复加载

## 4. 技术原理详解

### 4.1 iframe与同源策略

当使用file://协议打开本地HTML文件时：

```
file:///(略去)/Project/bounty-hunter/index.html
```

浏览器将其视为一个源。当index.html尝试通过iframe加载不同路径的HTML文件时：

```
file:///(略去)/Project/bounty-hunter/home/home.html
```

浏览器会将其视为不同源，并可能阻止这种加载，特别是在尝试进行JavaScript交互时。

### 4.2 标准页面跳转与同源策略

标准页面跳转（如`window.location.href`或`window.open`）不受同源策略限制，因为这是完全加载新页面，而非跨源通信。

### 4.3 为什么跳转到login.html而非index.html

从home页面注销时，跳转到login.html而非index.html的原因：

1. 如果跳转到index.html，会重新加载整个页面，包括音乐播放器
2. index.html中的iframe又会加载login.html
3. 结果是音乐播放器被重复加载

直接跳转到login.html避免了这个问题，因为不会重新加载index.html中的音乐播放器。

## 5. 开发建议

### 5.1 页面导航规则

1. **iframe使用限制**：
   - 仅在index.html中使用iframe加载login.html
   - 不要尝试通过iframe加载不同路径的页面

2. **页面跳转规则**：
   - 登录后直接跳转到home.html
   - 从home页面注销时跳转到login.html而非index.html
   - 其他页面间导航使用标准页面跳转

### 5.2 音乐播放器管理

1. 音乐播放器保持在index.html中
2. 避免重复加载index.html
3. 如需控制音乐，可通过localStorage等机制在页面间传递状态


## 6. 总结

项目当前的混合导航架构是为了解决浏览器file://协议下的安全限制而设计的。通过保留必要的iframe结构并使用标准页面跳转，既保证了音乐播放器的持续播放，又避免了浏览器的安全拦截。

未来的开发者在修改导航逻辑时，应当理解这些限制和解决方案，避免重新引入被浏览器拦截的问题。
        